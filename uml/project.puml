@startuml Mario 2D Engine

skinparam classAttributeIconSize 0
skinparam linetype ortho

title Mario 2D Game Engine

' ============================================
' CONTROLLER
' ============================================
package "controller" {
    class GameController {
        - currentLevel: Level
        - renderer: GameRenderer
        - physicsEngine: PhysicsEngine
        - inputHandler: InputHandler
        + create()
        + render()
        + loadLevel(path)
    }

    class InputHandler {
        + update(delta)
        + handlePlayerInput(player)
    }
}

' ============================================
' MODEL - ENTITIES
' ============================================
package "model.entity" {
    abstract class Entity {
        # position: Vector2
        # velocity: Vector2
        # bounds: Rectangle
        # active: boolean
        + {abstract} update(delta)
        + collidesWith(other): boolean
    }

    interface Enemy {
        + move(delta)
        + onPlayerCollision(player)
        + getDamage(): int
    }

    interface Collectible {
        + onCollect(player)
        + getScoreValue(): int
    }

    class Player {
        - health: int
        - score: int
        - lives: int
        + moveLeft()
        + moveRight()
        + jump()
        + takeDamage(damage)
    }

    class Goomba {
        - damage: int
        - direction: float
        + reverseDirection()
        + stompedByPlayer()
    }

    class Coin {
        - scoreValue: int
    }

    class EndTrigger {
        - bounds: Rectangle
        - nextLevel: String
    }
}

' ============================================
' MODEL - LEVEL
' ============================================
package "model.level" {
    class Level {
        - entities: List<Entity>
        - solidTiles: List<Rectangle>
        - player: Player
        - endTrigger: EndTrigger
        + addEntity(entity)
        + update(delta)
    }

    class LevelLoader {
        + loadLevel(path): Level
    }

    class LevelData {
        - width: int
        - height: int
        - layers: List<Layer>
        - tilesets: List<Tileset>
    }
}

' ============================================
' MODEL - PHYSICS
' ============================================
package "model.physics" {
    class PhysicsEngine {
        + handlePlayerTerrainCollision(player, tiles)
        + handlePlayerEnemyCollision(player, level)
        + handlePlayerCollectibleCollision(player, level)
        + handleEnemyTerrainCollision(enemy, tiles)
    }
}

' ============================================
' VIEW
' ============================================
package "view" {
    class GameRenderer {
        - textureManager: TextureManager
        - spriteAnimator: SpriteAnimator
        - tiledMapRenderer: TiledMapRenderer
        + render(level)
    }

    class AudioManager << Singleton >> {
        - {static} instance: AudioManager
        + {static} getInstance()
        + playMusic(name)
        + playSound(name)
    }

    class TextureManager << Singleton >> {
        - {static} instance: TextureManager
        + {static} getInstance()
        + getTexture(name): Texture
    }

    class SpriteAnimator {
        + getAnimationFrame(name, time): TextureRegion
    }

    class TilesetRenderer {
        + loadTilesets(level)
        + renderTileLayer(batch, level, layerName)
    }

    class TiledMapRenderer {
        + render(level, camera)
    }
}

' ============================================
' INHERITANCE
' ============================================
Player --|> Entity
Goomba --|> Entity
Coin --|> Entity

' ============================================
' INTERFACE IMPLEMENTATIONS
' ============================================
Goomba ..|> Enemy
Coin ..|> Collectible

' ============================================
' RELATIONSHIPS
' ============================================
GameController *-- Level
GameController *-- GameRenderer
GameController *-- PhysicsEngine
GameController *-- InputHandler
GameController ..> AudioManager

Level *-- "0..*" Entity
Level o-- Player
Level o-- EndTrigger

LevelLoader ..> Level : creates
LevelLoader ..> LevelData : parses

GameRenderer *-- TilesetRenderer
GameRenderer *-- SpriteAnimator
GameRenderer *-- TiledMapRenderer
GameRenderer ..> TextureManager

InputHandler ..> Player

PhysicsEngine ..> Level

' ============================================
' LEGEND
' ============================================
legend right
  |= Design Pattern |= Classes |
  | MVC | Controller, Entity/Level, Renderer |
  | Singleton | AudioManager, TextureManager |
  | Strategy | Enemy, Collectible interfaces |
endlegend

@enduml
